<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Scrapyard Welder â€“ $GorWeldd Debug v3 ğŸ”¥ğŸ—‘ï¸</title>
  <script src="https://unpkg.com/@solana/web3.js@latest/lib/index.iife.min.js"></script>
  <script src="https://unpkg.com/@solana/spl-token@latest/lib/index.iife.min.js"></script>
  <style>
    body { margin:0; font-family:Arial,sans-serif; background:#111; color:#eee; text-align:center; padding:20px; }
    h1 { color:#ff6600; }
    button { padding:12px 24px; background:#ff5500; color:white; border:none; border-radius:8px; margin:10px; cursor:pointer; }
    button:hover { background:#ff7700; }
    #status, #balance, #debug { font-size:18px; margin:15px; padding:10px; background:#222; border-radius:8px; }
    #debug { color:#ffcc00; white-space:pre-wrap; }
  </style>
</head>
<body>

  <h1>ğŸ—‘ï¸ğŸ”¥ GorWeldd Welder â€“ Debug Mode v3 ğŸ”¥ğŸ—‘ï¸</h1>
  <p><strong>Przed testem:</strong> Dodaj RPC https://rpc.gorbagana.wtf w Backpack i przeÅ‚Ä…cz sieÄ‡!</p>

  <button id="connect">Connect Backpack</button>
  <div id="status">Wallet: Nie poÅ‚Ä…czony</div>
  <div id="balance">Balance $GorWeldd: Nie sprawdzono</div>
  <button id="check-balance">SprawdÅº Balance / Debug</button>
  <div id="debug">Debug logi pojawiÄ… siÄ™ tutaj (otwÃ³rz F12 â†’ Console dla wiÄ™cej)</div>

  <script>
    const { Connection, PublicKey } = solanaWeb3;
    const { getAssociatedTokenAddressSync, getAccount } = splToken;

    const RPC_LIST = [
      "https://rpc.gorbagana.wtf",
      "https://rpc.trashscan.io",
      "https://api.gorbagana.dev"
    ];
    let currentRpcIndex = 0;
    let connection = new Connection(RPC_LIST[currentRpcIndex], "confirmed");

    const TOKEN_MINT = new PublicKey("GCQ4NYEd2P8vRFDn9wadeE1KAPfckWpzJUUyzTqyimG7");
    const DECIMALS = 9; // <-- ZmieÅ„ na 6 jeÅ›li Trashscan pokazuje 6 decimals!

    let walletPublicKey = null;
    let provider = null;

    function switchRpc() {
      currentRpcIndex = (currentRpcIndex + 1) % RPC_LIST.length;
      connection = new Connection(RPC_LIST[currentRpcIndex], "confirmed");
      document.getElementById('debug').innerText += `\nPrzeÅ‚Ä…czono RPC na: ${RPC_LIST[currentRpcIndex]}`;
      console.log("Nowy RPC:", RPC_LIST[currentRpcIndex]);
    }

    document.getElementById('connect').onclick = async () => {
      provider = window.backpack;
      if (!provider || !provider.isBackpack) {
        alert("UÅ¼yj Backpack wallet! Dodaj RPC https://rpc.gorbagana.wtf w ustawieniach.");
        return;
      }
      try {
        await provider.connect();
        walletPublicKey = new PublicKey(provider.publicKey.toString());
        document.getElementById('status').innerText = `Wallet poÅ‚Ä…czony: ${walletPublicKey.toBase58().slice(0,6)}...`;
        document.getElementById('debug').innerText += `\nConnect OK â€“ wallet: ${walletPublicKey.toBase58()}`;
      } catch (err) {
        document.getElementById('status').innerText = "BÅ‚Ä…d poÅ‚Ä…czenia â€“ sprawdÅº Backpack";
        document.getElementById('debug').innerText += `\nConnect error: ${err.message}`;
        console.error(err);
      }
    };

    document.getElementById('check-balance').onclick = async () => {
      if (!walletPublicKey) {
        document.getElementById('debug').innerText += `\nBrak poÅ‚Ä…czonego wallet â€“ kliknij Connect najpierw`;
        return;
      }

      document.getElementById('debug').innerText += `\nSprawdzam balance... (RPC: ${RPC_LIST[currentRpcIndex]})`;

      try {
        const ata = getAssociatedTokenAddressSync(TOKEN_MINT, walletPublicKey);
        const account = await getAccount(connection, ata);
        const balance = Number(account.amount) / (10 ** DECIMALS);
        document.getElementById('balance').innerText = `Balance $GorWeldd: ${balance.toFixed(4)}`;
        document.getElementById('debug').innerText += `\nSukces! ATA znaleziona, balance: ${balance}`;
      } catch (err) {
        document.getElementById('balance').innerText = "BÅ‚Ä…d / brak tokena / zÅ‚y RPC";
        document.getElementById('debug').innerText += `\nBÅ‚Ä…d balance: ${err.message}`;
        console.error("Balance error:", err);

        if (err.message.includes("Account not found") || err.message.includes("not found")) {
          document.getElementById('debug').innerText += `\nBrak ATA â€“ kup $GorWeldd w Trash Bin najpierw!`;
        }
        switchRpc(); // auto przeÅ‚Ä…cz RPC przy bÅ‚Ä™dzie
      }
    };
  </script>
</body>
</html>