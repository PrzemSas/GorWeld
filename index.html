<!DOCTYPE html>
<html lang="pl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>$GorWeldd Balance Checker ‚Äì Bezpieczna Wersja</title>
  <script src="https://unpkg.com/@solana/web3.js@latest/lib/index.iife.min.js"></script>
  <script src="https://unpkg.com/@solana/spl-token@latest/lib/index.iife.min.js"></script>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
      color: #eee;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 20px;
    }

    .container {
      max-width: 600px;
      width: 100%;
      background: rgba(255, 255, 255, 0.05);
      backdrop-filter: blur(10px);
      border-radius: 20px;
      padding: 40px;
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
      border: 1px solid rgba(255, 255, 255, 0.1);
    }

    h1 {
      color: #ff6600;
      font-size: 2.5em;
      margin-bottom: 10px;
      text-shadow: 0 0 20px rgba(255, 102, 0, 0.5);
    }

    .subtitle {
      color: #aaa;
      margin-bottom: 30px;
      font-size: 0.9em;
    }

    .warning {
      background: rgba(255, 193, 7, 0.1);
      border-left: 4px solid #ffc107;
      padding: 15px;
      margin-bottom: 25px;
      border-radius: 8px;
      font-size: 0.9em;
      line-height: 1.6;
    }

    .info-box {
      background: rgba(33, 150, 243, 0.1);
      border-left: 4px solid #2196f3;
      padding: 15px;
      margin-bottom: 25px;
      border-radius: 8px;
      font-size: 0.9em;
      line-height: 1.6;
    }

    button {
      width: 100%;
      padding: 15px 30px;
      background: linear-gradient(135deg, #ff5500 0%, #ff7700 100%);
      color: white;
      border: none;
      border-radius: 12px;
      font-size: 1.1em;
      font-weight: bold;
      cursor: pointer;
      transition: all 0.3s ease;
      box-shadow: 0 4px 15px rgba(255, 85, 0, 0.3);
      margin-bottom: 15px;
    }

    button:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(255, 85, 0, 0.4);
    }

    button:active {
      transform: translateY(0);
    }

    button:disabled {
      background: #555;
      cursor: not-allowed;
      box-shadow: none;
    }

    .status-box {
      background: rgba(0, 0, 0, 0.3);
      border-radius: 12px;
      padding: 20px;
      margin: 15px 0;
      border: 1px solid rgba(255, 255, 255, 0.1);
    }

    .status-label {
      color: #888;
      font-size: 0.85em;
      text-transform: uppercase;
      letter-spacing: 1px;
      margin-bottom: 8px;
    }

    .status-value {
      font-size: 1.3em;
      color: #fff;
      word-break: break-all;
    }

    .balance-value {
      font-size: 2em;
      color: #4caf50;
      font-weight: bold;
      text-shadow: 0 0 10px rgba(76, 175, 80, 0.3);
    }

    .debug-log {
      background: rgba(0, 0, 0, 0.5);
      border-radius: 12px;
      padding: 15px;
      margin-top: 20px;
      font-family: 'Courier New', monospace;
      font-size: 0.85em;
      color: #ffcc00;
      white-space: pre-wrap;
      word-break: break-word;
      max-height: 300px;
      overflow-y: auto;
      border: 1px solid rgba(255, 204, 0, 0.2);
    }

    .token-info {
      background: rgba(255, 255, 255, 0.03);
      border-radius: 12px;
      padding: 15px;
      margin-top: 20px;
      font-size: 0.85em;
      line-height: 1.8;
    }

    .token-info a {
      color: #2196f3;
      text-decoration: none;
      word-break: break-all;
    }

    .token-info a:hover {
      text-decoration: underline;
    }

    .emoji {
      font-size: 1.2em;
      margin-right: 5px;
    }

    .rpc-selector {
      margin: 20px 0;
      padding: 15px;
      background: rgba(0, 0, 0, 0.3);
      border-radius: 12px;
    }

    .rpc-selector label {
      display: block;
      margin-bottom: 10px;
      color: #aaa;
      font-size: 0.9em;
    }

    .rpc-selector select {
      width: 100%;
      padding: 10px;
      background: rgba(0, 0, 0, 0.5);
      color: #fff;
      border: 1px solid rgba(255, 255, 255, 0.2);
      border-radius: 8px;
      font-size: 1em;
      cursor: pointer;
    }

    .loading {
      display: inline-block;
      width: 20px;
      height: 20px;
      border: 3px solid rgba(255, 255, 255, 0.3);
      border-radius: 50%;
      border-top-color: #fff;
      animation: spin 1s ease-in-out infinite;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    footer {
      margin-top: 30px;
      text-align: center;
      color: #666;
      font-size: 0.85em;
    }
  </style>
</head>
<body>

  <div class="container">
    <h1><span class="emoji">üóëÔ∏èüî•</span>$GorWeldd Checker</h1>
    <p class="subtitle">Bezpieczne sprawdzanie salda tokena</p>

    <div class="warning">
      <strong>‚ö†Ô∏è Bezpiecze≈Ñstwo:</strong> Ta strona dzia≈Ça 100% lokalnie. Nie wysy≈Ça ≈ºadnych danych. 
      Mo≈ºesz jƒÖ zapisaƒá i u≈ºywaƒá offline. Sprawd≈∫ kod ≈∫r√≥d≈Çowy (Ctrl+U) przed u≈ºyciem!
    </div>

    <div class="info-box">
      <strong>‚ÑπÔ∏è Wyb√≥r RPC:</strong> Mo≈ºesz u≈ºywaƒá oficjalnego Solana RPC (wolniejsze, ale bezpieczne) 
      lub community RPC (szybsze, ale zaufaj operatorowi). Wyb√≥r nale≈ºy do Ciebie!
    </div>

    <div class="rpc-selector">
      <label for="rpc-select">Wybierz RPC endpoint:</label>
      <select id="rpc-select">
        <option value="https://api.mainnet-beta.solana.com">üîí Solana Mainnet (oficjalny - BEZPIECZNY)</option>
        <option value="https://rpc.gorbagana.wtf">üöÄ Gorbagana RPC (szybki)</option>
        <option value="https://rpc.trashscan.io">üöÄ Trashscan RPC (szybki)</option>
        <option value="https://api.gorbagana.dev">üöÄ Gorbagana API (szybki)</option>
      </select>
    </div>

    <button id="connect-btn">
      <span class="emoji">üîó</span> Po≈ÇƒÖcz Wallet
    </button>

    <div class="status-box">
      <div class="status-label">Status Po≈ÇƒÖczenia</div>
      <div class="status-value" id="wallet-status">Nie po≈ÇƒÖczony</div>
    </div>

    <button id="balance-btn" disabled>
      <span class="emoji">üí∞</span> Sprawd≈∫ Balance
    </button>

    <div class="status-box" id="balance-box" style="display:none;">
      <div class="status-label">Twoje Saldo $GorWeldd</div>
      <div class="balance-value" id="balance-value">0</div>
    </div>

    <div class="debug-log" id="debug-log">
üìã Logi pojawiƒÖ siƒô tutaj...
Otw√≥rz te≈º konsolƒô deweloperskƒÖ (F12) dla szczeg√≥≈Ç√≥w.
    </div>

    <div class="token-info">
      <strong>üìå Token Info:</strong><br>
      Mint: <a href="https://solscan.io/token/GCQ4NYEd2P8vRFDn9wadeE1KAPfckWpzJUUyzTqyimG7" target="_blank">
        GCQ4NYEd2P8vRFDn9wadeE1KAPfckWpzJUUyzTqyimG7
      </a><br>
      Decimals: 9<br>
      Network: Solana Mainnet
    </div>
  </div>

  <footer>
    Made with üíö for the Solana community | Open Source | No tracking
  </footer>

  <script>
    const { Connection, PublicKey } = solanaWeb3;
    const { getAssociatedTokenAddressSync, getAccount } = splToken;

    // Konfiguracja
    const TOKEN_MINT = new PublicKey("GCQ4NYEd2P8vRFDn9wadeE1KAPfckWpzJUUyzTqyimG7");
    const DECIMALS = 9;

    // Stan aplikacji
    let connection = null;
    let walletPublicKey = null;
    let provider = null;

    // Elementy DOM
    const connectBtn = document.getElementById('connect-btn');
    const balanceBtn = document.getElementById('balance-btn');
    const walletStatus = document.getElementById('wallet-status');
    const balanceValue = document.getElementById('balance-value');
    const balanceBox = document.getElementById('balance-box');
    const debugLog = document.getElementById('debug-log');
    const rpcSelect = document.getElementById('rpc-select');

    // Funkcja logowania
    function log(message, type = 'info') {
      const timestamp = new Date().toLocaleTimeString();
      const prefix = type === 'error' ? '‚ùå' : type === 'success' ? '‚úÖ' : '‚ÑπÔ∏è';
      const logMessage = `[${timestamp}] ${prefix} ${message}`;
      debugLog.textContent += '\n' + logMessage;
      debugLog.scrollTop = debugLog.scrollHeight;
      console.log(logMessage);
    }

    // Inicjalizacja po≈ÇƒÖczenia RPC
    function initConnection() {
      const rpcUrl = rpcSelect.value;
      connection = new Connection(rpcUrl, 'confirmed');
      log(`Po≈ÇƒÖczono z RPC: ${rpcUrl}`);
    }

    // Event listener dla zmiany RPC
    rpcSelect.addEventListener('change', () => {
      initConnection();
    });

    // Inicjalizacja przy starcie
    initConnection();

    // Po≈ÇƒÖcz wallet
    connectBtn.addEventListener('click', async () => {
      try {
        log('Pr√≥ba po≈ÇƒÖczenia z walletem...');
        
        // Sprawd≈∫ Backpack
        if (window.backpack?.isBackpack) {
          provider = window.backpack;
          log('Wykryto Backpack wallet');
        }
        // Sprawd≈∫ Phantom
        else if (window.solana?.isPhantom) {
          provider = window.solana;
          log('Wykryto Phantom wallet');
        }
        // Sprawd≈∫ dowolny wallet Solana
        else if (window.solana) {
          provider = window.solana;
          log('Wykryto wallet Solana');
        }
        else {
          throw new Error('Nie znaleziono ≈ºadnego wallet! Zainstaluj Phantom lub Backpack.');
        }

        // Po≈ÇƒÖcz
        await provider.connect();
        walletPublicKey = new PublicKey(provider.publicKey.toString());
        
        const shortAddress = walletPublicKey.toBase58().slice(0, 4) + '...' + 
                            walletPublicKey.toBase58().slice(-4);
        
        walletStatus.textContent = `‚úÖ ${shortAddress}`;
        walletStatus.style.color = '#4caf50';
        
        balanceBtn.disabled = false;
        connectBtn.textContent = '‚úÖ Po≈ÇƒÖczono';
        connectBtn.disabled = true;
        
        log(`Wallet po≈ÇƒÖczony: ${walletPublicKey.toBase58()}`, 'success');
        
      } catch (error) {
        log(`B≈ÇƒÖd po≈ÇƒÖczenia: ${error.message}`, 'error');
        walletStatus.textContent = '‚ùå B≈ÇƒÖd po≈ÇƒÖczenia';
        walletStatus.style.color = '#f44336';
        alert(`B≈ÇƒÖd: ${error.message}`);
      }
    });

    // Sprawd≈∫ balance
    balanceBtn.addEventListener('click', async () => {
      if (!walletPublicKey) {
        log('Brak po≈ÇƒÖczonego walleta!', 'error');
        return;
      }

      try {
        balanceBtn.innerHTML = '<span class="loading"></span> Sprawdzanie...';
        balanceBtn.disabled = true;
        
        log('Pobieranie adresu ATA...');
        const ata = getAssociatedTokenAddressSync(TOKEN_MINT, walletPublicKey);
        log(`ATA: ${ata.toBase58()}`);

        log('Sprawdzanie konta tokenowego...');
        const account = await getAccount(connection, ata);
        
        const balance = Number(account.amount) / (10 ** DECIMALS);
        
        balanceValue.textContent = balance.toLocaleString('pl-PL', {
          minimumFractionDigits: 4,
          maximumFractionDigits: 9
        });
        
        balanceBox.style.display = 'block';
        
        log(`‚úÖ Balance: ${balance} $GorWeldd`, 'success');
        log(`Raw amount: ${account.amount}`, 'info');
        
        balanceBtn.innerHTML = '<span class="emoji">üí∞</span> Od≈õwie≈º Balance';
        balanceBtn.disabled = false;
        
      } catch (error) {
        log(`B≈ÇƒÖd sprawdzania balance: ${error.message}`, 'error');
        
        if (error.message.includes('could not find account') || 
            error.message.includes('Account does not exist')) {
          balanceValue.textContent = '0';
          balanceBox.style.display = 'block';
          log('‚ö†Ô∏è Brak konta tokenowego - musisz najpierw kupiƒá $GorWeldd!', 'error');
          alert('Nie posiadasz jeszcze $GorWeldd!\n\nKup tokeny na:\n- Raydium\n- Jupiter\n- Lub przez Trash Bin');
        } else {
          alert(`B≈ÇƒÖd: ${error.message}\n\nSpr√≥buj zmieniƒá RPC lub od≈õwie≈º stronƒô.`);
        }
        
        balanceBtn.innerHTML = '<span class="emoji">üí∞</span> Sprawd≈∫ Balance';
        balanceBtn.disabled = false;
      }
    });

    // Automatyczne wykrywanie walleta przy za≈Çadowaniu
    window.addEventListener('load', () => {
      if (window.solana || window.backpack) {
        log('Wykryto zainstalowany wallet Solana!');
      } else {
        log('‚ö†Ô∏è Nie wykryto walleta. Zainstaluj Phantom lub Backpack.', 'error');
      }
    });

    // Nas≈Çuchiwanie na zmianƒô konta w wallet
    if (window.solana) {
      window.solana.on('accountChanged', (publicKey) => {
        if (publicKey) {
          log('üîÑ Wykryto zmianƒô konta w wallecie');
          location.reload();
        }
      });
    }
  </script>

</body>
</html>
